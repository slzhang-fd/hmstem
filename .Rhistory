'female' = sec4_data$female,
'partnerinhh' = sec4_data$partnerinhh,
'nlvch_2' = sec4_data$nlvch3g==2,
'nlvch_3' = sec4_data$nlvch3g==3,
'childinhh' = sec4_data$childinhh,
'survpar' = sec4_data$survpar,
'chdist_2' = sec4_data$chdist == 2,
'chdist_3' = sec4_data$chdist == 3,
'chdist_4' = sec4_data$chdist == 4,
'chdist_5' = sec4_data$chdist == 5,
'not employed' = sec4_data$notemployed,
'higher_edu' = sec4_data$highed,
'ln_hh_income' = sec4_data$ln_hhnyrde2dv,
'ownhome' = sec4_data$ownhome,
'long_ill' = sec4_data$long_ill,
'ethn_as_asbri' = sec4_data$ethnicity==2,
'ethn_bl_blbri' = sec4_data$ethnicity==3,
'ethn_mix_oth' = sec4_data$ethnicity==4,
'wave_2' = sec4_data$wave == 2,
'wave_3' = sec4_data$wave == 3,
"wave_4" = sec4_data$wave == 4,
"wave_5" = sec4_data$wave == 5)
sum(is.na(x_cov))
response_ind <- sapply(c('tcprac', 'tcfin', 'fcprac', 'fcfin'), grep, colnames(sec4_data))
response_ind
for(i in 1:4){
res_3fac <- hiera_3factor(as.matrix(sec4_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(x_cov),
j_ind=as.numeric(as.factor(sec4_data$shid9)),
i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
max_steps = 2500)
save(res_3fac, file = paste0('stem_3fac_res',i,'.rda'))
}
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/stem_3fac_res1.rda")
res_summary(res_3fac, burnin = 1000, p=ncol(x_cov),K=1)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/stem_res1.rda")
res_summary(res_2fac, burnin = 1000, p=ncol(xcov),K=1)
res_summary(res_2fac, burnin = 1000, p=32,K=1)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/jagsres1.rda")
summary(jags_res)[,c('Median','Mean')]
res_summary(res_3fac, burnin = 1000, p=ncol(x_cov),K=1)
## exchange with children
sec4_data <- as.data.table(read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/chddat.dta"))
table(sec4_data$wave)
x_cov <- data.frame('intercept' = rep(1, nrow(sec4_data)),
'age40' = sec4_data$age40,
'age40sq' = sec4_data$age40sq,
'female' = sec4_data$female,
'partnerinhh' = sec4_data$partnerinhh,
'nlvch_2' = sec4_data$nlvch3g==2,
'nlvch_3' = sec4_data$nlvch3g==3,
'childinhh' = sec4_data$childinhh,
'survpar' = sec4_data$survpar,
'chdist_2' = sec4_data$chdist == 2,
'chdist_3' = sec4_data$chdist == 3,
'chdist_4' = sec4_data$chdist == 4,
'chdist_5' = sec4_data$chdist == 5,
'not employed' = sec4_data$notemployed,
'higher_edu' = sec4_data$highed,
'ln_hh_income' = sec4_data$ln_hhnyrde2dv,
'ownhome' = sec4_data$ownhome,
'long_ill' = sec4_data$long_ill,
'ethn_as_asbri' = sec4_data$ethnicity==2,
'ethn_bl_blbri' = sec4_data$ethnicity==3,
'ethn_mix_oth' = sec4_data$ethnicity==4,
"wave_4" = sec4_data$wave == 4,
"wave_5" = sec4_data$wave == 5,
'wave_6' = sec4_data$wave == 6)
sum(is.na(x_cov))
colMeans(x_cov)
response_ind <- sapply(c('tcprac', 'tcfin', 'fcprac', 'fcfin'), grep, colnames(sec4_data))
for(i in 1:4){
res_3fac <- hiera_3factor(as.matrix(sec4_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(x_cov),
j_ind=as.numeric(as.factor(sec4_data$shid9)),
i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
max_steps = 2500)
save(res_3fac, file = paste0('stem_3fac_res',i,'.rda'))
}
res_summary(res_3fac, burnin = 1000, p=ncol(x_cov),K=1)
plot(res_3fac$coeffs_all[,1])
plot(res_3fac$coeffs_all[,2])
plot(res_3fac$coeffs_all[,3])
plot(res_3fac$coeffs_all[,4])
library(hmstem)
devtools::document()
setwd("~/Downloads/Github/hmstem")
devtools::document()
library(hmstem)
## simulate data
K <- 4
# group number
J <- 20000
K <- 4
# group number
J <- 10000
# 2 individuals in each group
N <- 30000
# 2 time points for each individual
NN <- 90000
# p coefficients
p <- 2
## set true parameters
# mu <- runif(K, -1, 1)
coeffs <- matrix(rnorm(K*p),p,K)
x_covs <- cbind(rep(1,NN),matrix(rnorm(NN*(p-1)),NN,(p-1)))
Sigma_e <- matrix(0.1, K, K)
diag(Sigma_e) <- 1
B_e <- t(chol(Sigma_e))
# diag(B_e) <- 1
Sigma_e <- B_e %*% t(B_e)
Sigma_u <- matrix(0.2, K,K)
diag(Sigma_u) <- runif(K, 1,2)
B_u <- t(chol(Sigma_u))
i_ind <- rep(1:N, each=3)
# View(cbind(j_ind,t_ind,jt_ind))
Y <- matrix(0, NN, K)
## generate random variables
U_all <- rmvnorm(N, sigma = B_u %*% t(B_u))
# Y_star <- outer(rep(1,NN), mu) + U_all[i_ind,] + V_all[j_ind,] + rmvnorm(NN, sigma = B_e %*% t(B_e))
Y_star <- x_covs %*% coeffs + U_all[i_ind,] + rmvnorm(NN, sigma = B_e %*% t(B_e))
library(mvtnorm)
## generate random variables
U_all <- rmvnorm(N, sigma = B_u %*% t(B_u))
# Y_star <- outer(rep(1,NN), mu) + U_all[i_ind,] + V_all[j_ind,] + rmvnorm(NN, sigma = B_e %*% t(B_e))
Y_star <- x_covs %*% coeffs + U_all[i_ind,] + rmvnorm(NN, sigma = B_e %*% t(B_e))
Y <- 1 * (Y_star>0)
## simulation for 1 factor model
## simulate data
K <- 4
N <- 40000
# 2 time points for each individual
NN <- 80000
# p coefficients
p <- 5
## set true parameters
# mu <- runif(K, -1, 1)
coeffs <- matrix(rnorm(K*p),p,K)
x_covs <- cbind(rep(1,NN),matrix(rnorm(NN*(p-1)),NN,(p-1)))
Sigma_e <- matrix(0.2, K, K)
diag(Sigma_e) <- 1
B_e <- t(chol(Sigma_e))
# diag(B_e) <- 1
Sigma_e <- B_e %*% t(B_e)
Sigma_u <- matrix(0.3, K,K)
diag(Sigma_u) <- runif(K, 1,2)
B_u <- t(chol(Sigma_u))
i_ind <- rep(1:N, each=2)
Y <- matrix(0, NN, K)
## generate random variables
U_all <- rmvnorm(N, sigma = B_u %*% t(B_u))
i_ind
## generate random variables
U_all <- rmvnorm(N, sigma = B_u %*% t(B_u))
Y_star <- x_covs %*% coeffs + U_all[i_ind,] + rmvnorm(NN, sigma = B_e %*% t(B_e))
Y <- 1 * (Y_star>0)
res_1fac <- hiera_1factor(Y, x_covs, i_ind, max_steps = 500)
library(hmstem)
devtools::document()
library(hmstem)
res_summary(res_1fac)
res_summary(res_1fac, burnin = 250, p=p, K=4)
coeffs
res_summary(res_1fac, burnin = 250, p=p, K=4)[[1]]
res_summary(res_1fac, burnin = 250, p=p, K=4)[[2]]
Sigma_e
Sigma_u
res_summary(res_1fac, burnin = 250, p=p, K=4)[[3]]
res_1fac[[2]]
dim(res_1fac)
dim(res_1fac$B_e_all)
ncol(res_1fac$B_e_all)
sqrt(ncol(res_1fac$B_e_all))
ncol(res_1fac$coeffs_all)
p
## exchange with children
sec4_data <- as.data.table(read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/chddat.dta"))
## 57562   154
colnames(sec4_data)
x_cov <- data.frame('intercept' = rep(1, nrow(sec4_data)),
'age40' = sec4_data$age40,
'age40sq' = sec4_data$age40sq,
'female' = sec4_data$female,
'partnerinhh' = sec4_data$partnerinhh,
'nlvch_2' = sec4_data$nlvch3g==2,
'nlvch_3' = sec4_data$nlvch3g==3,
'childinhh' = sec4_data$childinhh,
'survpar' = sec4_data$survpar,
'chdist_2' = sec4_data$chdist == 2,
'chdist_3' = sec4_data$chdist == 3,
'chdist_4' = sec4_data$chdist == 4,
'chdist_5' = sec4_data$chdist == 5,
'not employed' = sec4_data$notemployed,
'higher_edu' = sec4_data$highed,
'ln_hh_income' = sec4_data$ln_hhnyrde2dv,
'ownhome' = sec4_data$ownhome,
'long_ill' = sec4_data$long_ill,
'ethn_as_asbri' = sec4_data$ethnicity==2,
'ethn_bl_blbri' = sec4_data$ethnicity==3,
'ethn_mix_oth' = sec4_data$ethnicity==4,
"wave_4" = sec4_data$wave == 4,
"wave_5" = sec4_data$wave == 5,
'wave_6' = sec4_data$wave == 6)
sum(is.na(x_cov))
response_ind <- sapply(c('tcprac', 'tcfin', 'fcprac', 'fcfin'), grep, colnames(sec4_data))
for(i in 2:4){
res_3fac <- hiera_3factor(as.matrix(sec4_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(x_cov),
j_ind=as.numeric(as.factor(sec4_data$shid9)),
i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
max_steps = 2500)
save(res_3fac, file = paste0('stem_3fac_res',i,'.rda'))
}
sec3_data <- as.data.table(read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/pardat.dta"))
xcov <- data.frame('intercept' = rep(1, nrow(sec3_data)),
'age40' = sec3_data$age40,
'age40sq' = sec3_data$age40sq,
'female' = sec3_data$female,
'partnerinhh' = sec3_data$partnerinhh,
'nsib_1' = sec3_data$nsibtot3g==1,
'nsib_2' = sec3_data$nsibtot3g==2,
'childres_1' = sec3_data$childres==1,
'childres_2' = sec3_data$childres==2,
'childres_3' = sec3_data$childres==3,
'cy2to4' = sec3_data$cy2to4,
'cy5to10' = sec3_data$cy5to10,
'cy11to16' = sec3_data$cy11to16,
'cygt16' = sec3_data$cygt16,
'pmaxage70' = sec3_data$pmaxage70,
'pmaxage70sq' = sec3_data$pmaxage70sq,
"pardist_2" = sec3_data$pardist==2,
"pardist_3" = sec3_data$pardist==3,
"pardist_4" = sec3_data$pardist==4,
"pardist_5" = sec3_data$pardist==5,
'paralone' = sec3_data$paralone,
'notemployed' = sec3_data$notemployed,
'highed' = sec3_data$highed,
'ln_hh_income' = sec3_data$ln_hhnyrde2dv,
'ownhome' = sec3_data$ownhome,
'long_ill' = sec3_data$long_ill,
'ethn_as_asbri' = sec3_data$ethnicity==2,
'ethn_bl_blbri' = sec3_data$ethnicity==3,
'ethn_mix_oth' = sec3_data$ethnicity==4,
"wave_4" = sec3_data$wave == 4,
"wave_5" = sec3_data$wave == 5,
"wave_6" = sec3_data$wave == 6)
response_ind <- sapply(c('tpprac', 'tpfin', 'fpprac', 'fpfin'), grep, colnames(sec3_data))
for(i in 1:4){
res_1fac <- hiera_1factor(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
save(res_1fac, file = paste0('stem_1fac_res',i,'.rda'))
}
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_1fac_res1.rda")
res_summary(res_1fac, burnin = 1000)
library(hmstem)
devtools::document()
res_summary(res_1fac, burnin = 1000)
?apply
library(hmstem)
res_summary(res_1fac, burnin = 1000)
hiera_res <- res_1fac
K <- sqrt(ncol(hiera_res[[2]]))
p <- ncol(hiera_res[[1]]) / K
stem_len <- nrow(hiera_res[[2]])
coeffs_hat = matrix(colMeans(matrix(hiera_res[[1]][-(1:burnin),],ncol = p*K)),p,K)
burnin=1000
coeffs_hat = matrix(colMeans(matrix(hiera_res[[1]][-(1:burnin),],ncol = p*K)),p,K)
coeffs_sd = matrix(apply(matrix(hiera_res[[1]][-(1:burnin),],ncol = p*K), 2, sd),p,K)
Sigma_e_all <- Sigma_u_all <- Sigma_v_all <- Sigma_w_all <- matrix(0, stem_len - burnin, K*K)
for(i in (burnin+1):stem_len){
B_e_tmp <- matrix(hiera_res[[2]][i,],K,K)
Sigma_e_all[i,] <- c(B_e_tmp %*% t(B_e_tmp))
B_u_tmp <- matrix(hiera_res[[3]][i,],K,K)
Sigma_u_all[i,] <- c(B_u_tmp %*% t(B_u_tmp))
if(length(hiera_res)>=4){
B_v_tmp <- matrix(hiera_res[[4]][i,],K,K)
Sigma_v_all[i,] <- c(B_v_tmp %*% t(B_v_tmp))
}
if(length(hiera_res)>=5){
B_w_tmp <- matrix(hiera_res[[5]][i,], K,K)
Sigma_w_all[i,] <- c(B_w_tmp %*% t(B_w_tmp))
}
}
i
library(hmstem)
res_summary(res_1fac, burnin = 1000)
tmp <- res_summary(res_1fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd))
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
tmp
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_1fac_res2.rda")
tmp <- res_summary(res_1fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_1fac_res3.rda")
tmp <- res_summary(res_1fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_1fac_res4.rda")
tmp <- res_summary(res_1fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3fac_res1.rda")
tmp <- res_summary(res_3fac, burnin = 1000)
hiera_res=res_3fac
K <- sqrt(ncol(hiera_res[[2]]))
p <- ncol(hiera_res[[1]]) / K
stem_len <- nrow(hiera_res[[2]])
coeffs_hat = matrix(colMeans(matrix(hiera_res[[1]][-(1:burnin),],ncol = p*K)),p,K)
burnin=1000
K <- sqrt(ncol(hiera_res[[2]]))
p <- ncol(hiera_res[[1]]) / K
stem_len <- nrow(hiera_res[[2]])
coeffs_hat = matrix(colMeans(matrix(hiera_res[[1]][-(1:burnin),],ncol = p*K)),p,K)
coeffs_sd = matrix(apply(matrix(hiera_res[[1]][-(1:burnin),],ncol = p*K), 2, sd),p,K)
Sigma_e_all <- Sigma_u_all <- Sigma_v_all <- Sigma_w_all <- matrix(0, stem_len - burnin, K*K)
for(i in (burnin+1):stem_len){
B_e_tmp <- matrix(hiera_res[[2]][i,],K,K)
Sigma_e_all[i-burnin,] <- c(B_e_tmp %*% t(B_e_tmp))
B_u_tmp <- matrix(hiera_res[[3]][i,],K,K)
Sigma_u_all[i-burnin,] <- c(B_u_tmp %*% t(B_u_tmp))
if(length(hiera_res)>=4){
B_v_tmp <- matrix(hiera_res[[4]][i,],K,K)
Sigma_v_all[i-burnin,] <- c(B_v_tmp %*% t(B_v_tmp))
}
if(length(hiera_res)>=5){
B_w_tmp <- matrix(hiera_res[[5]][i,], K,K)
Sigma_w_all[i-burnin,] <- c(B_w_tmp %*% t(B_w_tmp))
}
}
list('coeffs'= coeffs_hat,
'coeffs_sd' = coeffs_sd,
'Sigma_e' = matrix(apply(Sigma_e_all,2,mean),K,K),
'Sigma_e_sd' = matrix(apply(Sigma_e_all,2,sd),K,K),
'Sigma_u' = matrix(apply(Sigma_u_all,2,mean),K,K),
'Sigma_u_sd' = matrix(apply(Sigma_u_all,2,sd),K,K),
'Sigma_v' = matrix(apply(Sigma_v_all,2,mean),K,K),
'Sigma_v_sd' = matrix(apply(Sigma_v_all,2,sd),K,K),
'Sigma_w' = matrix(apply(Sigma_w_all,2,mean),K,K),
'Sigma_w_sd' = matrix(apply(Sigma_w_all,2,sd),K,K))
library(hmstem)
library(hmstem)
tmp <- res_summary(res_3fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
round(cbind(tmp$Sigma_v, tmp$Sigma_v_sd),3)
round(cbind(tmp$Sigma_w, tmp$Sigma_w_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3fac_res2.rda")
tmp <- res_summary(res_3fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
round(cbind(tmp$Sigma_v, tmp$Sigma_v_sd),3)
round(cbind(tmp$Sigma_w, tmp$Sigma_w_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3fac_res3.rda")
tmp <- res_summary(res_3fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
round(cbind(tmp$Sigma_v, tmp$Sigma_v_sd),3)
round(cbind(tmp$Sigma_w, tmp$Sigma_w_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3fac_res4.rda")
tmp <- res_summary(res_3fac, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
round(cbind(tmp$Sigma_v, tmp$Sigma_v_sd),3)
round(cbind(tmp$Sigma_w, tmp$Sigma_w_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_1f4p_res.rda")
tmp <- res_summary(res_1fac, burnin = 1000)
tmp <- res_summary(res_1fac_4process, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
tmp$Sigma_u
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3f4p_res.rda")
tmp <- res_summary(res_3fac_4process, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
dim(res_3fac_4process$coeffs_all)
92/4
## exchange with children
sec4_data <- as.data.table(read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/chddat.dta"))
x_cov <- data.frame('intercept' = rep(1, nrow(sec4_data)),
'age40' = sec4_data$age40,
'age40sq' = sec4_data$age40sq,
'female' = sec4_data$female,
'partnerinhh' = sec4_data$partnerinhh,
'nlvch_2' = sec4_data$nlvch3g==2,
'nlvch_3' = sec4_data$nlvch3g==3,
'childinhh' = sec4_data$childinhh,
'survpar' = sec4_data$survpar,
'chdist_2' = sec4_data$chdist == 2,
'chdist_3' = sec4_data$chdist == 3,
'chdist_4' = sec4_data$chdist == 4,
'chdist_5' = sec4_data$chdist == 5,
'not employed' = sec4_data$notemployed,
'higher_edu' = sec4_data$highed,
'ln_hh_income' = sec4_data$ln_hhnyrde2dv,
'ownhome' = sec4_data$ownhome,
'long_ill' = sec4_data$long_ill,
'ethn_as_asbri' = sec4_data$ethnicity==2,
'ethn_bl_blbri' = sec4_data$ethnicity==3,
'ethn_mix_oth' = sec4_data$ethnicity==4,
"wave_4" = sec4_data$wave == 4,
"wave_5" = sec4_data$wave == 5,
'wave_6' = sec4_data$wave == 6)
dim(x_covs)
dim(x_cov)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3f4p_res.rda")
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3f4p_res.rda")
tmp <- res_summary(res_3fac_4process, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
round(cbind(tmp$Sigma_e, tmp$Sigma_e_sd),3)
round(cbind(tmp$Sigma_u, tmp$Sigma_u_sd),3)
round(cbind(tmp$Sigma_v, tmp$Sigma_v_sd),3)
round(cbind(tmp$Sigma_w, tmp$Sigma_w_sd),3)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_1f4p_res.rda")
tmp <- res_summary(res_1fac_4process, burnin = 1000)
round(cbind(tmp$coeffs,tmp$coeffs_sd),3)
round(cbind(tmp$Sigma_e, tmp$Sigma_e_sd),3)
## exchange with children
sec4_data <- as.data.table(read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/chddat.dta"))
x_cov <- data.frame('intercept' = rep(1, nrow(sec4_data)),
'age40' = sec4_data$age40,
'age40sq' = sec4_data$age40sq,
'female' = sec4_data$female,
'partnerinhh' = sec4_data$partnerinhh,
'nlvch_2' = sec4_data$nlvch3g==2,
'nlvch_3' = sec4_data$nlvch3g==3,
'childinhh' = sec4_data$childinhh,
'survpar' = sec4_data$survpar,
'chdist_2' = sec4_data$chdist == 2,
'chdist_3' = sec4_data$chdist == 3,
'chdist_4' = sec4_data$chdist == 4,
'chdist_5' = sec4_data$chdist == 5,
'not employed' = sec4_data$notemployed,
'higher_edu' = sec4_data$highed,
'ln_hh_income' = sec4_data$ln_hhnyrde2dv,
'ownhome' = sec4_data$ownhome,
'long_ill' = sec4_data$long_ill,
'ethn_as_asbri' = sec4_data$ethnicity==2,
'ethn_bl_blbri' = sec4_data$ethnicity==3,
'ethn_mix_oth' = sec4_data$ethnicity==4,
"wave_4" = sec4_data$wave == 4,
"wave_5" = sec4_data$wave == 5,
'wave_6' = sec4_data$wave == 6)
setwd("~/Downloads/Github/hmstem")
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(hmstem)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/stem_3f4p_res.rda")
View(res_3fac_4process)
res_3fac_4process$coeffs_all
library(hms)
library(hmstem)
res_summary(res_3fac_4process, burnin = 1000)
res <- res_summary(res_3fac_4process, burnin = 1000)
View(res)
fisher <- hiera_3_fac_fisher_info(as.matrix(sec4_data[,response_ind, with=FALSE]), x_covs=as.matrix(x_cov),
j_ind=as.numeric(as.factor(sec4_data$shid9)),
i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
res$coeffs, res$Sigma_e, res$Sigma_u, res$Sigma_v, res$Sigma_w, max_steps = 100)
## exchange with children
sec4_data <- as.data.table(read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/chddat.dta"))
library(data.table)
library(haven)
library(runjags)
library(hmstem)
## exchange with children
sec4_data <- as.data.table(read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/chddat.dta"))
## 57562   154
colnames(sec4_data)
x_cov <- data.frame('intercept' = rep(1, nrow(sec4_data)),
'age40' = sec4_data$age40,
'age40sq' = sec4_data$age40sq,
'female' = sec4_data$female,
'partnerinhh' = sec4_data$partnerinhh,
'nlvch_2' = sec4_data$nlvch3g==2,
'nlvch_3' = sec4_data$nlvch3g==3,
'childinhh' = sec4_data$childinhh,
'survpar' = sec4_data$survpar,
'chdist_2' = sec4_data$chdist == 2,
'chdist_3' = sec4_data$chdist == 3,
'chdist_4' = sec4_data$chdist == 4,
'chdist_5' = sec4_data$chdist == 5,
'not employed' = sec4_data$notemployed,
'higher_edu' = sec4_data$highed,
'ln_hh_income' = sec4_data$ln_hhnyrde2dv,
'ownhome' = sec4_data$ownhome,
'long_ill' = sec4_data$long_ill,
'ethn_as_asbri' = sec4_data$ethnicity==2,
'ethn_bl_blbri' = sec4_data$ethnicity==3,
'ethn_mix_oth' = sec4_data$ethnicity==4,
"wave_4" = sec4_data$wave == 4,
"wave_5" = sec4_data$wave == 5,
'wave_6' = sec4_data$wave == 6)
response_ind <- sapply(c('tcprac', 'tcfin', 'fcprac', 'fcfin'), grep, colnames(sec4_data))
res <- res_summary(res_3fac_4process, burnin = 1000)
fisher <- hiera_3_fac_fisher_info(as.matrix(sec4_data[,response_ind, with=FALSE]), x_covs=as.matrix(x_cov),
j_ind=as.numeric(as.factor(sec4_data$shid9)),
i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
res$coeffs, res$Sigma_e, res$Sigma_u, res$Sigma_v, res$Sigma_w, max_steps = 100)
sqrt(diag(solve(fisher)))
diag(solve(fisher))
View(fisher)
diag(solve(-fisher))
View(fisher)
library(hmstem)
devtools::document()
