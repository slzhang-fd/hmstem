i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
max_steps = 5000, res = res_3fac_4process)
plot(1:5000, res_3fac_4process1$Sigma_e_all[,2], "l", ylim = c(-0.1, 0.6))
points(1:5000, res_3fac_4process1$Sigma_e_all[,3], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,4], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,7], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,8], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,12], "l")
plot(1:5000, res_3fac_4process$Sigma_e_all[,2], "l", ylim = c(-0.1, 0.6))
points(1:5000, res_3fac_4process$Sigma_e_all[,3], "l")
plot(1:5000, res_3fac_4process1$Sigma_e_all[,2], "l", ylim = c(-0.1, 0.6))
points(1:5000, res_3fac_4process1$Sigma_e_all[,3], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,4], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,7], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,8], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,12], "l")
plot(1:5000, res_3fac_4process1$Sigma_e_all[,2], "l", ylim = c(-0.1, 0.6))
points(1:5000, res_3fac_4process1$Sigma_e_all[,3], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,4], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,7], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,8], "l")
points(1:5000, res_3fac_4process1$Sigma_e_all[,12], "l")
tmp <- res_summary_3fac_gibbs(res_3fac_4process1, burnin = 1000)
tmp
save(res_3fac_4process, res_3fac_4process1, file = 'gibbs_3f4p_res.rda')
tmp <- res_summary_3fac_gibbs(res_3fac_4process1, burnin = 0)
tmp
library(hmstem)
devtools::document()
library(hmstem)
## simulation for 1 factor model
## simulate data
K <- 2
N <- 40000
# 2 time points for each individual
NN <- 80000
# p coefficients
p <- 4
## set true parameters
# mu <- runif(K, -1, 1)
coeffs <- matrix(rnorm(K*p),p,K)
x_covs <- cbind(rep(1,NN),matrix(rnorm(NN*(p-1)),NN,(p-1)))
Sigma_e <- matrix(0.2, K, K)
diag(Sigma_e) <- 1
B_e <- t(chol(Sigma_e))
# diag(B_e) <- 1
Sigma_e <- B_e %*% t(B_e)
Sigma_u <- matrix(0.3, K,K)
diag(Sigma_u) <- runif(K, 1,2)
B_u <- t(chol(Sigma_u))
i_ind <- rep(1:N, each=2)
Y <- matrix(0, NN, K)
## generate random variables
U_all <- rmvnorm(N, sigma = B_u %*% t(B_u))
Y_star <- x_covs %*% coeffs + U_all[i_ind,] + rmvnorm(NN, sigma = B_e %*% t(B_e))
Y <- 1 * (Y_star>0)
res_1fac <- hiera_1factor_gibbs(Y, x_covs, i_ind, max_steps = 500)
res_1fac11 <- hiera_1factor(Y, x_covs, i_ind, max_steps = 500)
library(hmstem)
matrix(colMeans(res_1fac$coeffs_all[-(1:200),]), nrow = p)
coeffs
sum((matrix(colMeans(res_1fac$coeffs_all[-(1:200),]), nrow = p) - coeffs)^2)
sum((matrix(colMeans(res_1fac11$coeffs_all[-(1:200),]), nrow = p) - coeffs)^2)
devtools::document()
library(hmstem)
res_summary(res_summary_1fac_gibbs, burnin = 200)
res_summary_1fac_gibbs(res_1fac, burnin = 200)
coeffs
plot(res_1fac$Sigma_e_all[,2])
Sigma_e
Sigma_u
plot(res_1fac$Sigma_u_all[,1])
plot(res_1fac$Sigma_u_all[,2])
sec3_data <- read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/pardat.dta")
xcov <- data.frame('intercept' = rep(1, nrow(sec3_data)),
'age40' = sec3_data$age40,
'age40sq' = sec3_data$age40sq,
'female' = sec3_data$female,
'partnerinhh' = sec3_data$partnerinhh,
'nsib_1' = sec3_data$nsibtot3g==1,
'nsib_2' = sec3_data$nsibtot3g==2,
'childres_1' = sec3_data$childres==1,
'childres_2' = sec3_data$childres==2,
'childres_3' = sec3_data$childres==3,
'cy2to4' = sec3_data$cy2to4,
'cy5to10' = sec3_data$cy5to10,
'cy11to16' = sec3_data$cy11to16,
'cygt16' = sec3_data$cygt16,
'pmaxage70' = sec3_data$pmaxage70,
'pmaxage70sq' = sec3_data$pmaxage70sq,
"pardist_2" = sec3_data$pardist==2,
"pardist_3" = sec3_data$pardist==3,
"pardist_4" = sec3_data$pardist==4,
"pardist_5" = sec3_data$pardist==5,
'paralone' = sec3_data$paralone,
'notemployed' = sec3_data$notemployed,
'highed' = sec3_data$highed,
'ln_hh_income' = sec3_data$ln_hhnyrde2dv,
'ownhome' = sec3_data$ownhome,
'long_ill' = sec3_data$long_ill,
'ethn_as_asbri' = sec3_data$ethnicity==2,
'ethn_bl_blbri' = sec3_data$ethnicity==3,
'ethn_mix_oth' = sec3_data$ethnicity==4,
"wave_4" = sec3_data$wave == 4,
"wave_5" = sec3_data$wave == 5,
"wave_6" = sec3_data$wave == 6)
response_ind <- sapply(c('tpprac', 'tpfin', 'fpprac', 'fpfin'), grep, colnames(sec3_data))
response <- sec3_data[,response_ind]
colnames(response) <- c('tpprac', 'tpfin', 'fpprac', 'fpfin')
for(i in 1:4){
# res_1fac <- hiera_1factor(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                           i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                           max_steps = 2500)
# res_summary(res_1fac, burnin = 1000)
# f_mat <- hiera_1fac_fisher_info(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                                      i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                                      res_1fac, burnin = 1000, max_steps = 10000)
res_1fac <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
save(res_1fac, f_mat, file = paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',i,'.rda'))
}
save(res_1fac, file = paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',i,'.rda'))
for(i in 2:4){
# res_1fac <- hiera_1factor(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                           i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                           max_steps = 2500)
# res_summary(res_1fac, burnin = 1000)
# f_mat <- hiera_1fac_fisher_info(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                                      i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                                      res_1fac, burnin = 1000, max_steps = 10000)
res_1fac <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
save(res_1fac, file = paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',i,'.rda'))
}
res_1fac_4process <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
library(hmstem)
res_1fac_4process <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
library(hmstem)
res_1fac_4process <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
Sigma_u_all[iter,] <- Sigma_u
library(hmstem)
res_1fac_4process <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
res_summary_1fac_gibbs(res_1fac_4process, burnin = 1000)
plot(res_1fac_4process$Sigma_e_all[,2])
plot(res_1fac_4process$Sigma_e_all[,3])
plot(res_1fac_4process$Sigma_e_all[,4])
devtools::document()
library(hmstem)
res_1fac_4process1 <- hiera_1factor_Gibbs_addon(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 5000, res_1fac_4process)
library(hmstem)
res_1fac_4process1 <- hiera_1factor_Gibbs_addon(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 5000, res_1fac_4process)
library(hmstem)
library(hmstem)
res_1fac_4process1 <- hiera_1factor_Gibbs_addon(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 5000, res_1fac_4process)
library(hmstem)
res_1fac_4process1 <- hiera_1factor_Gibbs_addon(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 5000, res_1fac_4process)
plot(res_1fac_4process1$Sigma_e_all[,4])
plot(res_1fac_4process1$Sigma_e_all[,1])
plot(res_1fac_4process1$Sigma_e_all[,2])
plot(res_1fac_4process1$Sigma_e_all[,3])
plot(res_1fac_4process1$Sigma_e_all[,7])
plot(res_1fac_4process1$Sigma_e_all[,8])
plot(res_1fac_4process1$Sigma_e_all[,2])
res_summary_1fac_gibbs(res_1fac_4process1, burnin = 1000)
save(res_1fac_4process, res_1fac_4process1,
file = paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1f4p_res',i,'.rda'))
1f4p_res <- res_summary_1fac_gibbs(res_1fac_4process1, burnin = 1000)
singlef4p_res <- res_summary_1fac_gibbs(res_1fac_4process1, burnin = 1000)
singlef4p_res
save(singlef4p_res, file = '~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/singlef4p_res.rda')
singlef4p_res
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',1,'.rda'))
singlef_tpprac <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
singlef_tpfin <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',1,'.rda'))
singlef_tpprac <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',2,'.rda'))
singlef_tpfin <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',1,'.rda'))
singlef_fpprac <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',1,'.rda'))
singlef_fpfin <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
singlef4p_res
singlef_tpprac
singlef_tpfin
singlef_fpprac
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',3,'.rda'))
singlef_fpprac <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_1fac_res',4,'.rda'))
singlef_fpfin <- res_summary_1fac_gibbs(res_1fac, burnin = 1000)
singlef_fpprac
singlef_fpfin
save(singlef_tpprac, singlef_tpfin, singlef_fpprac, singlef_fpfin, singlef4p_res,
file = '~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/single_factor_res.rda')
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',1,'.rda'))
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',1,'.rda'))
singlef_tcprac <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',2,'.rda'))
singlef_tcfin <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',3,'.rda'))
singlef_fcprac <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',4,'.rda'))
singlef_fcfin <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3f4p_res.rda')
threef_4p_res <- res_summary_3fac_gibbs(res_3fac_4process1, burnin = 1000)
threef_4p_res
save(threef_tcprac, threef_tcfin, threef_fcprac, threef_fcfin, threef_4p_res,
file = '~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/three_factor_res.rda')
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',1,'.rda'))
threef_tcprac <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',2,'.rda'))
threef_tcfin <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',3,'.rda'))
threef_fcprac <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load(paste0('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3fac_res',4,'.rda'))
threef_fcfin <- res_summary_3fac_gibbs(res_3fac, burnin = 1000)
load('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3f4p_res.rda')
threef_4p_res <- res_summary_3fac_gibbs(res_3fac_4process1, burnin = 1000)
save(threef_tcprac, threef_tcfin, threef_fcprac, threef_fcfin, threef_4p_res,
file = '~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/three_factor_res.rda')
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/singlef4p_res.rda")
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/single_factor_res.rda")
View(singlef_tpprac)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/three_factor_res.rda")
View(threef_tcfin)
library(coda)
threef_4p_res
load('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3f4p_res.rda')
effectiveSize(res_3fac_4process1$Sigma_e_all)
effectiveSize(res_3fac_4process1$Sigma_u_all)
effectiveSize(res_3fac_4process1$coeffs_all)
library(hmstem)
devtools::document()
library(hmstem)
X <- rmvnorm(10000, sigma = Sigma)
Sigma <- matrix(0.3, 4,4)
diag(Sigma) <- 1
X <- rmvnorm(10000, sigma = Sigma)
sigma0 <- diag(4)
res <- matrix(0, 1000, 6)
for(i in 1:1000){
sigma0 <- sample_sigmae_MH(sigma0, solve(sigma0), X, step_size = 0.01)
res[i,] <- sigma0[lower.tri(sigma0)]
}
plot(res[,2])
plot(res[,1])
devtools::document()
library(hmstem)
Sigma <- matrix(0.3, 4,4)
diag(Sigma) <- 1
X <- rmvnorm(10000, sigma = Sigma)
sigma0 <- diag(4)
res <- matrix(0, 1000, 6)
res0 <- matrix(0, 1000, 6)
system.time(
for(i in 1:1000){
sigma0 <- sample_sigmae_MH(sigma0, solve(sigma0), X, step_size = 0.01)
res[i,] <- sigma0[lower.tri(sigma0)]
})
sigma0 <- diag(4)
system.time(
for(i in 1:1000){
sigma0 <- sample_sigmae_MH0(sigma0, solve(sigma0), X, step_size = 0.01)
res0[i,] <- sigma0[lower.tri(sigma0)]
})
plot(res[,1], res0[1])
plot(res[,1])
points(res0[,1]])
points(res0[,1])
effectiveSize(res)
effectiveSize(res0)
plot(1:1000, res[,1], 'l')
points(1:1000, res0[,1], 'l')
mean(diff(res[,1])==0)
mean(diff(res0[,1])==0)
colMeans(res[-(1:200),])
colMeans(res0[-(1:200),])
sec3_data <- read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/pardat.dta")
xcov <- data.frame('intercept' = rep(1, nrow(sec3_data)),
'age40' = sec3_data$age40,
'age40sq' = sec3_data$age40sq,
'female' = sec3_data$female,
'partnerinhh' = sec3_data$partnerinhh,
'nsib_1' = sec3_data$nsibtot3g==1,
'nsib_2' = sec3_data$nsibtot3g==2,
'childres_1' = sec3_data$childres==1,
'childres_2' = sec3_data$childres==2,
'childres_3' = sec3_data$childres==3,
'cy2to4' = sec3_data$cy2to4,
'cy5to10' = sec3_data$cy5to10,
'cy11to16' = sec3_data$cy11to16,
'cygt16' = sec3_data$cygt16,
'pmaxage70' = sec3_data$pmaxage70,
'pmaxage70sq' = sec3_data$pmaxage70sq,
"pardist_2" = sec3_data$pardist==2,
"pardist_3" = sec3_data$pardist==3,
"pardist_4" = sec3_data$pardist==4,
"pardist_5" = sec3_data$pardist==5,
'paralone' = sec3_data$paralone,
'notemployed' = sec3_data$notemployed,
'highed' = sec3_data$highed,
'ln_hh_income' = sec3_data$ln_hhnyrde2dv,
'ownhome' = sec3_data$ownhome,
'long_ill' = sec3_data$long_ill,
'ethn_as_asbri' = sec3_data$ethnicity==2,
'ethn_bl_blbri' = sec3_data$ethnicity==3,
'ethn_mix_oth' = sec3_data$ethnicity==4,
"wave_4" = sec3_data$wave == 4,
"wave_5" = sec3_data$wave == 5,
"wave_6" = sec3_data$wave == 6)
response_ind <- sapply(c('tpprac', 'tpfin', 'fpprac', 'fpfin'), grep, colnames(sec3_data))
response <- sec3_data[,response_ind]
colnames(response) <- c('tpprac', 'tpfin', 'fpprac', 'fpfin')
i=1
# res_1fac <- hiera_1factor(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                           i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                           max_steps = 2500)
# res_summary(res_1fac, burnin = 1000)
# f_mat <- hiera_1fac_fisher_info(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                                      i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                                      res_1fac, burnin = 1000, max_steps = 10000)
res_1fac <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
library(hmstem)
library(hmstem)
# res_1fac <- hiera_1factor(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                           i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                           max_steps = 2500)
# res_summary(res_1fac, burnin = 1000)
# f_mat <- hiera_1fac_fisher_info(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                                      i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                                      res_1fac, burnin = 1000, max_steps = 10000)
res_1fac <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
res_1fac_4process <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
library(hmstem)
devtools::document()
library(hmstem)
# res_1fac <- hiera_1factor(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                           i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                           max_steps = 2500)
# res_summary(res_1fac, burnin = 1000)
# f_mat <- hiera_1fac_fisher_info(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
#                                      i_ind=as.numeric(as.factor(sec3_data$pidp)),
#                                      res_1fac, burnin = 1000, max_steps = 10000)
res_1fac <- hiera_1factor_gibbs(as.matrix(sec3_data[,response_ind[i], with=FALSE]), x_covs=as.matrix(xcov),
i_ind=as.numeric(as.factor(sec3_data$pidp)),
max_steps = 2500)
library(hmstem)
sec4_data <- read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/chddat.dta")
## 57562   154
colnames(sec4_data)
xcov <- data.frame('intercept' = rep(1, nrow(sec4_data)),
'age40' = sec4_data$age40,
'age40sq' = sec4_data$age40sq,
'female' = sec4_data$female,
'partnerinhh' = sec4_data$partnerinhh,
'nlvch_2' = sec4_data$nlvch3g==2,
'nlvch_3' = sec4_data$nlvch3g==3,
'childinhh' = sec4_data$childinhh,
'survpar' = sec4_data$survpar,
'chdist_2' = sec4_data$chdist == 2,
'chdist_3' = sec4_data$chdist == 3,
'chdist_4' = sec4_data$chdist == 4,
'chdist_5' = sec4_data$chdist == 5,
'not employed' = sec4_data$notemployed,
'higher_edu' = sec4_data$highed,
'ln_hh_income' = sec4_data$ln_hhnyrde2dv,
'ownhome' = sec4_data$ownhome,
'long_ill' = sec4_data$long_ill,
'ethn_as_asbri' = sec4_data$ethnicity==2,
'ethn_bl_blbri' = sec4_data$ethnicity==3,
'ethn_mix_oth' = sec4_data$ethnicity==4,
"wave_4" = sec4_data$wave == 4,
"wave_5" = sec4_data$wave == 5,
'wave_6' = sec4_data$wave == 6)
sum(is.na(xcov))
response_ind <- sapply(c('tcprac', 'tcfin', 'fcprac', 'fcfin'), grep, colnames(sec4_data))
response <- sec4_data[,response_ind]
colnames(response) <- c('tcprac', 'tcfin', 'fcprac', 'fcfin')
# for(tt in 1:500){
#   tmp <- matrix(f_mat$store_res[tt,],27,27)
#   res1[tt,] <- round(sqrt(diag(solve(tmp))),3)
# }
# View(res1)
# res_3fac_4process <- hiera_3factor(as.matrix(sec4_data[,response_ind, with=FALSE]), x_covs=as.matrix(x_cov),
#                                    j_ind=as.numeric(as.factor(sec4_data$shid9)),
#                                    i_ind=as.numeric(as.factor(sec4_data$pidp)),
#                                    jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
#                                    max_steps = 2500)
res_3fac_4process <- hiera_3factor_Gibbs(as.matrix(sec4_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
j_ind=as.numeric(as.factor(sec4_data$shid9)),
i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
max_steps = 2500)
plot(res_3fac_4process$Sigma_e_all[,2])
plot(res_3fac_4process$Sigma_e_all[,3])
plot(res_3fac_4process$Sigma_e_all[,4])
res_summary_3fac_gibbs(res_3fac_4process, burnin = 1000)
plot(res_3fac_4process$Sigma_e_all[,2])
plot(res_3fac_4process$Sigma_e_all[,3])
# for(tt in 1:500){
#   tmp <- matrix(f_mat$store_res[tt,],27,27)
#   res1[tt,] <- round(sqrt(diag(solve(tmp))),3)
# }
# View(res1)
# res_3fac_4process <- hiera_3factor(as.matrix(sec4_data[,response_ind, with=FALSE]), x_covs=as.matrix(x_cov),
#                                    j_ind=as.numeric(as.factor(sec4_data$shid9)),
#                                    i_ind=as.numeric(as.factor(sec4_data$pidp)),
#                                    jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
#                                    max_steps = 2500)
res_3fac_4process <- hiera_3factor_Gibbs(as.matrix(sec4_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
j_ind=as.numeric(as.factor(sec4_data$shid9)),
i_ind=as.numeric(as.factor(sec4_data$pidp)),
jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
max_steps = 5000, cor_step_size = 0.02)
plot(res_3fac_4process$Sigma_e_all[,3])
plot(res_3fac_4process$Sigma_e_all[,2])
plot(res_3fac_4process$Sigma_e_all[,3])
plot(res_3fac_4process$Sigma_e_all[,4])
plot(res_3fac_4process$Sigma_e_all[,7])
plot(res_3fac_4process$Sigma_e_all[,8])
res_summary_3fac_gibbs(res_3fac_4process, burnin = 2500)
plot(res_3fac_4process$Sigma_e_all[,12])
# res_3fac_4process1 <- hiera_3factor_Gibbs_addon(as.matrix(sec4_data[,response_ind, with=FALSE]), x_covs=as.matrix(xcov),
#                                          j_ind=as.numeric(as.factor(sec4_data$shid9)),
#                                          i_ind=as.numeric(as.factor(sec4_data$pidp)),
#                                          jt_ind = as.numeric(as.factor(paste(sec4_data$shid9,sec4_data$wave))),
#                                          max_steps = 5000, res = res_3fac_4process)
save(res_3fac_4process, file = '~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3f4p_res1.rda')
load('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3f4p_res.rda')
plot(res_3fac_4process1$Sigma_e_all[,12])
plot(res_3fac_4process$Sigma_e_all[,12])
plot(res_3fac_4process1$Sigma_e_all[,12])
load('~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res_gibbs/gibbs_3f4p_res1.rda')
plot(res_3fac_4process$Sigma_e_all[,2])
plot(res_3fac_4process$Sigma_e_all[,3])
library(coda)
effectiveSize(res_3fac_4process$coeffs_all)
effectiveSize(res_3fac_4process$Sigma_e_all)
effectiveSize(res_3fac_4process$Sigma_u_all)
effectiveSize(res_3fac_4process$coeffs_all)
effectiveSize(res_3fac_4process$coeffs_all[-(1:1000),])
effectiveSize(res_3fac_4process$coeffs_all)
res_summary_3fac_gibbs(res_3fac_4process, burnin = 2500)
effectiveSize(res_3fac_4process$coeffs_all)
res_summary_3fac_gibbs(res_3fac_4process, burnin = 2500)
names(res_3fac_4process)
load("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/res/parexc_data_res.rda")
parexc_4process_res$coeffs
parexc_4process_res$coeffs_se
sec3_data <- read_dta("~/Dropbox/Projs/DyLAnIE/3Gen_analysis/updated_version/data/pardat.dta")
xcov <- data.frame('intercept' = rep(1, nrow(sec3_data)),
'age40' = sec3_data$age40,
'age40sq' = sec3_data$age40sq,
'female' = sec3_data$female,
'partnerinhh' = sec3_data$partnerinhh,
'nsib_1' = sec3_data$nsibtot3g==1,
'nsib_2' = sec3_data$nsibtot3g==2,
'childres_1' = sec3_data$childres==1,
'childres_2' = sec3_data$childres==2,
'childres_3' = sec3_data$childres==3,
'cy2to4' = sec3_data$cy2to4,
'cy5to10' = sec3_data$cy5to10,
'cy11to16' = sec3_data$cy11to16,
'cygt16' = sec3_data$cygt16,
'pmaxage70' = sec3_data$pmaxage70,
'pmaxage70sq' = sec3_data$pmaxage70sq,
"pardist_2" = sec3_data$pardist==2,
"pardist_3" = sec3_data$pardist==3,
"pardist_4" = sec3_data$pardist==4,
"pardist_5" = sec3_data$pardist==5,
'paralone' = sec3_data$paralone,
'notemployed' = sec3_data$notemployed,
'highed' = sec3_data$highed,
'ln_hh_income' = sec3_data$ln_hhnyrde2dv,
'ownhome' = sec3_data$ownhome,
'long_ill' = sec3_data$long_ill,
'ethn_as_asbri' = sec3_data$ethnicity==2,
'ethn_bl_blbri' = sec3_data$ethnicity==3,
'ethn_mix_oth' = sec3_data$ethnicity==4,
"wave_4" = sec3_data$wave == 4,
"wave_5" = sec3_data$wave == 5,
"wave_6" = sec3_data$wave == 6)
response_ind <- sapply(c('tpprac', 'tpfin', 'fpprac', 'fpfin'), grep, colnames(sec3_data))
response_ind
response <- sec3_data[,response_ind]
dim(response)
colnames(sec3_data)
